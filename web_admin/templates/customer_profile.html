{% extends 'base.html' %}
{% block title %}Профиль клиента{% endblock %}
{% block content %}
<div class="d-flex align-items-center justify-content-between mb-4">
  <h1 class="h3">Профиль клиента</h1>
  <a class="btn btn-secondary" href="{{ url_for('customers') }}">← Назад к клиентам</a>
</div>

<div class="row">
  <div class="col-md-4 mb-4">
    <div class="card">
      <div class="card-body text-center">
        <div class="customer-avatar mx-auto mb-3" style="width: 80px; height: 80px; font-size: 2rem;">
          {{ customer[2][0] if customer[2] else '?' }}
        </div>
        <h4>{{ customer[2] or 'Не указано' }}</h4>
        <p class="text-muted">ID: {{ customer[0] }}</p>

        <div class="mt-3">
          {% if customer[7] %}
            <span class="badge bg-danger">Заблокирован</span>
          {% elif customer[6] %}
            <span class="badge bg-success">Активен</span>
          {% else %}
            <span class="badge bg-secondary">Неактивен</span>
          {% endif %}
        </div>
      </div>
    </div>

    <div class="card mt-3">
      <div class="card-header">
        <h5 class="mb-0">Контактная информация</h5>
      </div>
      <div class="card-body">
        <p><strong>Телефон:</strong><br>{{ customer[3] or 'Не указан' }}</p>
        <p><strong>Telegram ID:</strong><br>{{ customer[1] or 'Не указан' }}</p>
        <p><strong>Язык:</strong><br>{{ customer[4] or 'Не указан' }}</p>
        <p><strong>Регистрация:</strong><br>{{ customer[5][:19] if customer[5] else 'Не указана' }}</p>
      </div>
    </div>
  </div>

  <div class="col-md-8">
    <div class="card mb-4">
      <div class="card-header">
        <h5 class="mb-0">Статистика</h5>
      </div>
      <div class="card-body">
        <div class="row text-center">
          <div class="col-md-4">
            <div class="customer-orders-count">{{ stats[0] }}</div>
            <div class="customer-orders-label">Заказов</div>
          </div>
          <div class="col-md-4">
            <div class="customer-spent-amount">${{ "%.2f"|format(stats[1]) }}</div>
            <div class="customer-orders-label">Потрачено</div>
          </div>
          <div class="col-md-4">
            <div class="customer-spent-amount">${{ "%.2f"|format(stats[2]) }}</div>
            <div class="customer-orders-label">Средний чек</div>
          </div>
        </div>
      </div>
    </div>

    <div class="card">
      <div class="card-header">
        <h5 class="mb-0">История заказов</h5>
      </div>
      <div class="card-body">
        {% if orders %}
        <div class="table-responsive">
          <table class="table table-hover">
            <thead>
              <tr>
                <th>ID</th>
                <th>Дата</th>
                <th>Сумма</th>
                <th>Статус</th>
                <th>Действия</th>
              </tr>
            </thead>
            <tbody>
              {% for order in orders %}
              <tr>
                <td>#{{ order[0] }}</td>
                <td>{{ order[1][:19] if order[1] else '-' }}</td>
                <td>${{ "%.2f"|format(order[2]) }}</td>
                <td>
                  {% if order[3] == 'pending' %}
                    <span class="badge bg-warning">В ожидании</span>
                  {% elif order[3] == 'confirmed' %}
                    <span class="badge bg-info">Подтвержден</span>
                  {% elif order[3] == 'shipped' %}
                    <span class="badge bg-primary">Отправлен</span>
                  {% elif order[3] == 'delivered' %}
                    <span class="badge bg-success">Доставлен</span>
                  {% elif order[3] == 'cancelled' %}
                    <span class="badge bg-danger">Отменен</span>
                  {% else %}
                    <span class="badge bg-secondary">{{ order[3] }}</span>
                  {% endif %}
                </td>
                <td>
                  <a href="{{ url_for('order_detail', order_id=order[0]) }}" class="btn btn-sm btn-outline-primary">
                    <i class="fas fa-eye"></i> Просмотр
                  </a>
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
        {% else %}
        <div class="text-center text-muted py-4">
          <i class="fas fa-shopping-cart fa-3x mb-3"></i>
          <p>У клиента пока нет заказов</p>
        </div>
        {% endif %}
      </div>
    </div>
  </div>
</div>
{% endblock %}
