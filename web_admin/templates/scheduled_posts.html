{% extends "base.html" %}

{% block title %}–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –ø–æ—Å—Ç—ã - –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å{% endblock %}
{% block page_title %}–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –ø–æ—Å—Ç—ã{% endblock %}

{% block content %}
<!-- –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è -->
<div class="row mb-4">
    <div class="col-12">
        <div class="card">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center">
                    <h5 class="mb-0">
                        <i class="fas fa-clock me-2"></i>
                        –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º–∏ –ø–æ—Å—Ç–∞–º–∏
                    </h5>
                    <a href="{{ url_for('create_post') }}" class="btn btn-success">
                        <i class="fas fa-plus me-2"></i>
                        –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –ø–æ—Å—Ç
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- –°–ø–∏—Å–æ–∫ –ø–æ—Å—Ç–æ–≤ -->
<div class="row">
    <div class="col-lg-8">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="fas fa-list me-2"></i>
                    –ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–æ—Å—Ç—ã ({{ posts|length }})
                </h5>
            </div>
            <div class="card-body">
                {% if posts %}
                    {% for post in posts %}
                    <div class="card mb-3 {{ 'border-success' if post[7] else 'border-secondary' }}">
                        <div class="card-body">
                            <div class="d-flex justify-content-between align-items-start">
                                <div class="flex-grow-1">
                                    <h6 class="card-title">
                                        {% if post[7] %}
                                            <i class="fas fa-play-circle text-success me-2"></i>
                                        {% else %}
                                            <i class="fas fa-pause-circle text-secondary me-2"></i>
                                        {% endif %}
                                        {{ post[1] }}
                                    </h6>
                                    <p class="card-text text-muted">{{ post[2][:100] }}{% if post[2]|length > 100 %}...{% endif %}</p>
                                    
                                    {% if post|length > 11 and post[11] %}
                                    <div class="mb-2">
                                        <img src="{{ post[11] }}" alt="–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø–æ—Å—Ç–∞" 
                                             class="img-thumbnail" style="max-height: 60px; max-width: 100px;">
                                    </div>
                                    {% endif %}
                                    
                                    <div class="row mt-3">
                                        <div class="col-md-4">
                                            <small class="text-muted">
                                                <i class="fas fa-sun me-1"></i>–£—Ç—Ä–æ–º: 
                                                <strong>{{ post[3] or '–ù–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ' }}</strong>
                                            </small>
                                        </div>
                                        <div class="col-md-4">
                                            <small class="text-muted">
                                                <i class="fas fa-sun me-1"></i>–î–Ω–µ–º: 
                                                <strong>{{ post[4] or '–ù–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ' }}</strong>
                                            </small>
                                        </div>
                                        <div class="col-md-4">
                                            <small class="text-muted">
                                                <i class="fas fa-moon me-1"></i>–í–µ—á–µ—Ä–æ–º: 
                                                <strong>{{ post[5] or '–ù–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ' }}</strong>
                                            </small>
                                        </div>
                                    </div>
                                    
                                    <div class="mt-2">
                                        <span class="badge bg-info">
                                            <i class="fas fa-users me-1"></i>
                                            {% if post[6] == 'channel' %}üì¢ –ö–∞–Ω–∞–ª
                                            {% elif post[6] == 'all' %}–í—Å–µ –∫–ª–∏–µ–Ω—Ç—ã
                                            {% elif post[6] == 'active' %}–ê–∫—Ç–∏–≤–Ω—ã–µ –∫–ª–∏–µ–Ω—Ç—ã
                                            {% elif post[6] == 'vip' %}VIP –∫–ª–∏–µ–Ω—Ç—ã
                                            {% elif post[6] == 'new' %}–ù–æ–≤—ã–µ –∫–ª–∏–µ–Ω—Ç—ã
                                            {% endif %}
                                        </span>
                                        <span class="badge bg-{{ 'success' if post[7] else 'secondary' }}">
                                            {{ '–ê–∫—Ç–∏–≤–µ–Ω' if post[7] else '–í—ã–∫–ª—é—á–µ–Ω' }}
                                        </span>
                                    </div>
                                </div>
                                
                                <div class="btn-group-vertical">
                                    <a href="{{ url_for('edit_post', post_id=post[0]) }}" 
                                       class="btn btn-outline-primary btn-sm mb-1">
                                        <i class="fas fa-edit"></i>
                                    </a>
                                    
                                    <form method="POST" action="{{ url_for('send_now_post') }}" style="display: inline;">
                                        <input type="hidden" name="post_id" value="{{ post[0] }}">
                                        <button type="submit" class="btn btn-outline-success btn-sm mb-1" 
                                                title="–û—Ç–ø—Ä–∞–≤–∏—Ç—å –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ" 
                                                onclick="return confirm('–û—Ç–ø—Ä–∞–≤–∏—Ç—å —ç—Ç–æ—Ç –ø–æ—Å—Ç –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å?')">
                                            <i class="fas fa-paper-plane"></i>
                                        </button>
                                    </form>
                                    
                                    <form method="POST" action="{{ url_for('toggle_post_status') }}" style="display: inline;">
                                        <input type="hidden" name="post_id" value="{{ post[0] }}">
                                        <input type="hidden" name="current_status" value="{{ post[7] }}">
                                        <button type="submit" class="btn btn-outline-{{ 'warning' if post[7] else 'success' }} btn-sm mb-1" 
                                                title="{{ '–í—ã–∫–ª—é—á–∏—Ç—å' if post[7] else '–í–∫–ª—é—á–∏—Ç—å' }}">
                                            <i class="fas fa-{{ 'pause' if post[7] else 'play' }}"></i>
                                        </button>
                                    </form>
                                    
                                    <form method="POST" action="{{ url_for('delete_post') }}" style="display: inline;">
                                        <input type="hidden" name="post_id" value="{{ post[0] }}">
                                        <button type="submit" class="btn btn-outline-danger btn-sm" 
                                                onclick="return confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–æ—Å—Ç?')" title="–£–¥–∞–ª–∏—Ç—å">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                {% else %}
                    <div class="text-center py-5">
                        <i class="fas fa-clock fa-3x text-muted mb-3"></i>
                        <h5 class="text-muted">–ù–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö –ø–æ—Å—Ç–æ–≤</h5>
                        <p class="text-muted">–°–æ–∑–¥–∞–π—Ç–µ –ø–µ—Ä–≤—ã–π –ø–æ—Å—Ç –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π —Ä–∞—Å—Å—ã–ª–∫–∏</p>
                        <a href="{{ url_for('create_post') }}" class="btn btn-success">
                            <i class="fas fa-plus me-2"></i>
                            –°–æ–∑–¥–∞—Ç—å –ø–æ—Å—Ç
                        </a>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
    
    <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
    <div class="col-lg-4">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="fas fa-chart-bar me-2"></i>
                    –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞ 7 –¥–Ω–µ–π
                </h5>
            </div>
            <div class="card-body">
                {% if stats %}
                    {% for stat in stats %}
                    <div class="post-stat-item">
                        <div class="post-stat-info">
                            <div class="post-stat-title">{{ stat[0] }}</div>
                            <small class="post-stat-time">
                                {% if stat[1] == 'morning' %}üåÖ –£—Ç—Ä–æ–º
                                {% elif stat[1] == 'afternoon' %}‚òÄÔ∏è –î–Ω–µ–º
                                {% elif stat[1] == 'evening' %}üåÜ –í–µ—á–µ—Ä–æ–º
                                {% endif %}
                            </small>
                        </div>
                        <div class="post-stat-numbers">
                            <div class="post-stat-sent">{{ stat[2] }}</div>
                            <small class="post-stat-sent-label">–æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ</small>
                            {% if stat[3] > 0 %}
                                <div class="post-stat-errors">{{ stat[3] }} –æ—à–∏–±–æ–∫</div>
                            {% endif %}
                        </div>
                    </div>
                    {% endfor %}
                {% else %}
                    <div class="text-center py-4">
                        <i class="fas fa-chart-bar fa-2x text-muted mb-2"></i>
                        <p class="text-muted">–ù–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏</p>
                    </div>
                {% endif %}
            </div>
        </div>
        
        <!-- –ë—ã—Å—Ç—Ä—ã–µ —à–∞–±–ª–æ–Ω—ã -->
        <div class="card mt-4">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="fas fa-magic me-2"></i>
                    –ë—ã—Å—Ç—Ä—ã–µ —à–∞–±–ª–æ–Ω—ã
                </h5>
            </div>
            <div class="card-body">
                <div class="d-grid gap-2">
                    <button type="button" class="btn btn-outline-primary btn-sm" onclick="createTemplate('morning')">
                        <i class="fas fa-sun me-1"></i>
                        –£—Ç—Ä–µ–Ω–Ω–µ–µ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ
                    </button>
                    <button type="button" class="btn btn-outline-warning btn-sm" onclick="createTemplate('promotion')">
                        <i class="fas fa-gift me-1"></i>
                        –ê–∫—Ü–∏—è –¥–Ω—è
                    </button>
                    <button type="button" class="btn btn-outline-info btn-sm" onclick="createTemplate('evening')">
                        <i class="fas fa-moon me-1"></i>
                        –í–µ—á–µ—Ä–Ω–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
                    </button>
                    <form method="POST" action="{{ url_for('test_channel_post') }}" style="display: inline;">
                        <button type="submit" class="btn btn-outline-success btn-sm w-100 mt-2">
                            <i class="fas fa-paper-plane me-1"></i>
                            –¢–µ—Å—Ç –∫–∞–Ω–∞–ª–∞
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
function createTemplate(type) {
    const templates = {
        'morning': {
            title: '–î–æ–±—Ä–æ–µ —É—Ç—Ä–æ!',
            content: 'üåÖ –î–æ–±—Ä–æ–µ —É—Ç—Ä–æ! –ù–∞—á–Ω–∏—Ç–µ –¥–µ–Ω—å —Å –≤—ã–≥–æ–¥–Ω—ã—Ö –ø–æ–∫—É–ø–æ–∫!\n\nüõç –ù–æ–≤–∏–Ω–∫–∏ –≤ –∫–∞—Ç–∞–ª–æ–≥–µ –∂–¥—É—Ç –≤–∞—Å!\nüí∞ –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Ü–µ–Ω—ã —Ç–æ–ª—å–∫–æ —Å–µ–≥–æ–¥–Ω—è!'
        },
        'promotion': {
            title: '–ê–∫—Ü–∏—è –¥–Ω—è!',
            content: 'üî• –ì–æ—Ä—è—á–∞—è –∞–∫—Ü–∏—è –¥–Ω—è!\n\nüéÅ –°–∫–∏–¥–∫–∏ –¥–æ 50% –Ω–∞ –ø–æ–ø—É–ª—è—Ä–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã!\n‚è∞ –¢–æ–ª—å–∫–æ –¥–æ –∫–æ–Ω—Ü–∞ –¥–Ω—è!'
        },
        'evening': {
            title: '–í–µ—á–µ—Ä–Ω–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏',
            content: 'üåÜ –î–æ–±—Ä—ã–π –≤–µ—á–µ—Ä!\n\nüí° –°–ø–µ—Ü–∏–∞–ª—å–Ω–æ –¥–ª—è –≤–∞—Å –ø–æ–¥–æ–±—Ä–∞–ª–∏ –∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã!\nüõí –û—Ñ–æ—Ä–º–∏—Ç–µ –∑–∞–∫–∞–∑ —Å–µ–≥–æ–¥–Ω—è –∏ –ø–æ–ª—É—á–∏—Ç–µ –±–µ—Å–ø–ª–∞—Ç–Ω—É—é –¥–æ—Å—Ç–∞–≤–∫—É!'
        }
    };
    
    const template = templates[type];
    if (template) {
        const url = new URL('{{ url_for("create_post") }}', window.location.origin);
        url.searchParams.set('template_title', template.title);
        url.searchParams.set('template_content', template.content);
        window.location.href = url.toString();
    }
}
</script>
{% endblock %}